# EIGRP



## 维护的三张表

### 1. 邻居表

​	记录运行EIGRP的直连路由器的IP地址。

​	EIGRP在运行时需要首先跟周边的直连路由器建立EIGRP邻居关系。

#### 邻居关系

​	跟OSPF一样，EIGRP使用邻居的概念。在路由器之间通过非常轻量级的EIGRP Hello报文检查邻居之间的可达性，维护邻居关系。

EIGRP邻居发现，邻居参数协商以及维护邻居关系都由EIGRP Hello报文完成。

> 使用组播地址224.0.0.10发送Hello报文。  
>
> 默认每5s发送一次Hello报文，如果连续15s没收到Hello报文，则断开邻居关系，删除从该邻居学到的所有路由。



EIGRP要求建立邻居关系的两台路由器，下列参数需要匹配：

- AS号一致,  `类似于进程号`
- K 值，默认10100
- 处于同一子网
- 认证信息
- router-id必须不同





### 2. 拓扑表

​	去往某个路径的所有集合。包括所有FS（可行后继路由器）

<img src="./EIGRP.assets/image-20241218175901985.png" alt="image-20241218175901985" style="zoom:50%;" />

- 目的网络的可行距离FD
- 所有的可行后继路由器FS
- 每一个可行后继路由器所通告的到达目的网络的通告距离AD；

- 本地路由器所计算的经过每一个可行后继路由器到达目的网络的距离，也就是基于可行后继路由器所通告的到达目的子网的距离和本地路由器与该可行后继路由器之间相连链路的成本计算所得的距离；

### 3. 路由表

​	最优的路由会加入路由表，其他路由作为备选路径。

​	包括拓扑表中所有FS当中选出的S（后继路由器）所传递的路由器。

<img src="./EIGRP.assets/image-20241218160917499.png" alt="image-20241218160917499" style="zoom: 50%;" />

## 术语

### 邻接关系

> 邻接是指两个互相交换路由信息的邻居之间形成的一条逻辑的关联关系。

​	EIGRP刚启动时，路由器使用 Hello 数据包发现它的邻居并标识自己给邻居识别。

​	当邻居被发现时，EIGRP 协议将试图和它的邻居形成一个邻接关系。一旦邻接建立成功，路由器就可以从它们的邻居那里接收路由更新消息了。

### 通告距离（AD）

​	或称为RD（报告距离），邻居报告到达目标网络的metric

### 计算距离（CD）

​	AD + 本地路由器到达邻居的距离metric

### 可行性距离（Feasible Distance，FD）

​	**当前S的CD，**本地路由器到达每个目的网络的最小度量值metric就是该目的网络的可行距离

### 后继路由器（Successor）

​	到达目标网络的最佳路径**（CD最小）**的下一跳路由器S

### 可行后继路由器（Feasible Successor，FS）

> 如果本地路由器的邻居路由器所通告的到达目的网络的距离**满足了 FC**，那么这个邻居就会成为该目的网络的一个可行后继路由器。

​	到达目标网络的备用路由的下一跳路由器。所有的FS都会存储在EIGRP拓扑表内。

### 可行性条件（Feasibility Condition，FC）

​	需要满足本地路由器的一个邻居路由器所通告的到达一个目的网络的距离AD是否小于本地路由器到达相同目的网络的可行距离（FD）。    **FD  >  RD**   不满足当不了FS路由器

​	FC是EIGRP确保完全无环的关键。FC是一个路由没有环路的充分非必要条件。

​	只要有一条路由有环路风险，无论它是否有环，都不会被EIGRP采纳。可能导致一部分实际上无环的路径无法进入路由表。

<img src="./EIGRP.assets/image-20241218155850326.png" alt="image-20241218155850326" style="zoom: 50%;" />

## 如何实现快速收敛？

​	当当前S不再可用时，EIGRP搜索自己的拓扑表，如果有另一个FS，则不经过任何计算，直接通过另一个FS转发数据，同时该FS也就成为了S。如果FS全挂了，R1会发送请求给R4，如果R4有去往2.0网段路由，则直接发送给R1，并使用R4作为S。

## 扩散更新算法DUAL

​	DUAL（扩散更新算法）: 选择到每个目的网络的最小开销、loop-free的路径

​	为了随时能够打破路由环路，而使用扩散计算去执行一个分布式最短路径路由选择。

​	Loop-free：AD < FD 

<img src="C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20241218141244216.png" alt="image-20241218141244216" style="zoom:50%;" />

操作DUAL的前提条件   `使用邻居发现/恢复和可靠传输协议（RTP）来确定这些前提条件`

- 一个节点需要在有限的时间内检测到一个新邻居的存在或一个相连邻居的丢失。
- 在一个正在运行的链路上传送的所有消息应该在一个有限的时间内正确地收到，并且包含正确的序列号。
- 所有的消息，包括改变链路的代价、链路失败和发现新邻居的通告，都应该在一个有限的时间内一次一个地处理，并且应该被有顺序地检测到。





### Metric计算

​	默认，EIGRP使用**带宽和延迟**参与Metric计算，可选的使用可靠性和负载（不推荐）参与Metric计算

> 计算延迟时，使用的是根据端口带宽得到一个参考延迟，而非实际延迟。实际上对Metric影响最大的还是带宽

```c
BandWidth = 10^7/链路的最小带宽
Delay = 路径延迟之和（以10us为单位）
Metric = (Bandwidth + Delay) * 256;
```



## 配置命令

```cmd
router eigrp <AS号>
network <net-number>   # 宣告直连网段’

# show 命令
show ip route eigrp
show ip protocols
show ip eigrp interfaces
show ip eigrp neighbors [detail]
show ip eigrp topology [all]
show ip eigrp traffic
debug ip eigrp
```

<img src="./EIGRP.assets/image-20241218141443795.png" alt="image-20241218141443795" style="zoom:50%;" />