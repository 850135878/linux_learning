# RIP协议

Routing Information Protocol 路由信息协议，用于在网关和其他主机之间交换路由信息的动态路由协议。

运行在同一个AS（自治系统）号内的路由协议。<font color='red'>**内部网关协议**</font> 

> AS号：一种用于识别互联网上每个自治系统的唯一编号。一个AS号就是一个运营商或大型公司。
>
> **16位AS号（ASN-16）**：范围是1到65535，其中64512到65535为私有保留号段。
>
> **32位AS号（ASN-32）**：扩展了号码范围，以应对不断增长的网络需求。



<font color='red'>**有类别路由选择协议**</font>       适用于中小型网络

> 有类别路由选择协议特征：（通告路由更新的时候不会携带子网掩码）
>
> ​	**在通告目的地址时，不能随之一起通告它的掩码地址。**所以，首先**必须匹配一个**与目的地址对应于A类、B类或C类的**主网络号**。

> 对于每个通过这台路由器的**数据包**：
>
> - 如果目的地址是一个和路由器直连的主网络的成员，那么该网络的路由器接口上配置的子网掩码将被用来确定目标地址的子网。
> - 如果不是，则路由器将会尝试去匹配该目的地址对应于A类、B类或C类的主网络号。



RIP 是<font color='red'>**距离矢量协议**</font>，默认会自动开启汇总功能，即在边界路由器上将路由汇总成主类网段。但是，一般都需要关闭自动汇总。就算在需要的时候，也是通过手动汇总的方式。

```
# IOU2关闭自动汇总
IOU2(config-router)#no auto-summary
# IOU1手动开启汇总
IOU1(config-if)#ip summary-address rip 172.16.0.0 255.255.0.0
```

<img src="./RIP.assets/image-20240925173553944.png" alt="image-20240925173553944" style="zoom: 50%;" />

## 版本

### RIPv1

有类路由协议，通过**广播（255.255.255.255）**的形式来发送路由更新的

### RIPv2

无类路由协议，通过**组播（224.0.0.9）**的形式来发送路由更新的



## 四个时间

### 1. 更新时间

默认30s。运行RIP的路由器会每隔30s，向邻接路由器发送自己完整的路由表信息。

### 2. 失效时间

​	默认是180s。如果在180s内没收到来自对方的更新，则认为对方可能处于失效状态。

### 3. 抑制时间

默认是180s，用于维护路由表的稳定，避免环路。

> 不一致的路由信息会导致rip的网络产生环路。



#### 1. 避免环路机制

##### 1.1 定义最大跳数

当RIP的数据包到达第16跳时，就会执行数据包的丢弃流程，所以最大可达跳数是15跳。

##### 1.2 水平分割

从一个接口收到的路由条目信息，该信息不会再从该接口发送出去

##### 1.3 路由毒化

开启了路由毒化功能后，就会自动关闭水平分割。标记了中毒的路由信息，其跳数会被设置为无穷大。

##### 1.4 抑制计时器

在180s内，不会再相信其他路由器发送过来的相关路由的信息（比如E0口网线处于松动情况，一会有路由，一会没有路由）

<img src="./RIP.assets/image-20240925164531125.png" alt="image-20240925164531125" style="zoom: 50%;" />

##### 1.5 触发更新

一旦路由表发送变化，马上触发路由更新。



### 4. 刷新时间

默认是240s，经过240s后，原本处于失效状态的路由条目信息就会被路由器删除。







## 距离矢量算法

设D(i,j)表示从实体i到实体j最佳路径的度量，即实体i到实体j的开销。

![image-20240924135446125](./RIP.assets/image-20240924135446125.png)

每个表项包含的信息：

- 目的IP地址
- 度量，到达目的网络所经过的路由器个数，跳数
- 到达目的网络的下一个网关IP地址；若目的网络是直连路由， 则忽略此项
- 路由变更标识
- 与路由相关的各种计时器



## 消息格式

​	RIP是一种基于udp的协议。每个使用RIP协议的主机都有一个**路由进程**，**发送和接收UDP端口号为520的数据报文**。所有指向另一个主机的RIP处理器的通信都被发送到520端口。

> 所有路由更新消息都从520端口发送。非请求路由更新消息的源端口和目的端口都等于520。响应请求而发送的消息被发送到请求发出的端口。**特定的查询和调试请求可能从520以外的端口发送**，但它们被定向到目标机器上的520端口。

​	**“静”进程**是指**通常不发送任何消息的进程**。但是，它**侦听其他进程发送的消息**。不充当网关的主机可能会使用”静“RIP，去侦听路由更新，以便监视本地网关并使其内部路由表保持最新状态。与除一个网络外的所有网络失去联系的网关可能会选择”静“模式，因为它实际上不再是网关。

但是，如果相邻的网关有可能依赖其消息来检测故障网络已经恢复运行，则不应该这样做。

<img src="./RIP.assets/image-20240924140830544.png" alt="image-20240924140830544" style="zoom: 67%;" />

每条消息包含一条命令、一个版本号和路由条目（最多25条）。每个路由条目包括地址族标识、路由可达IP地址和路由的跳数。

- 命令：1表示请求消息（**rip update request** 请求rip路由更新），2表示响应消息（**rip update response** 响应rip路由更新）。
  - 请求 --->  要求其他系统发送全部或部分路由表。
  - 应答 --->  发送全部或部分路由表。可能是响应请求或轮询而发送的，也可能是发送方生成的更新消息
- 版本号：值为1，表示RIP-1；值为2，表示RIP-2。
- 地址族标识（AFI）：对于IP，该项为2。
- IP地址（4种类型）：路由的目的IP地址。
  - `子网号（131.108.1.0）`
  - `主机地址（131.108.1.1）`
  - `主类网络号（131.108.0.0）`
  - `全 0（表示默认路由）`
- 度量：路由的跳数，该字段的取值范围在1~16。



> **间隔30s的原因：避免大量路由器同时发送路由表而造成网络拥塞**



### 请求消息类型

- 请求整个路由表

​	请求消息含有一个地址族标识字段为 0（地址为 0.0.0.0），度量值为 16 的单条路由，接收到这个请求的设备将通过单播方式向发出请求的地址回送它的整个路由表，并遵循一些规则如水平分隔和边界汇总。

- 请求部分路由信息

​	一些诊断测试过程可能需要知道某个或某些具体路由的信息。这种情况下，**请求消息可以与特定地址的路由条目**一起发送。接收到该请求的设备将根据请求消息逐个处理这些条目，构成一个响应消息。

​	如果该设备的路由表中已有请求消息中地址相对应的路由条目，则将其路由条目的度量值填入 metric 字段。如果没有，metric 字段就被设置为 16。在不考虑水平分隔或边界汇总的情况下，响应消息将正确地告诉这台路由器了解的信息。



### 定时器

#### 1. 路由更新定时器

每**30秒**向所有相邻的网关发送路由更新消息。然而，当网络中存在大量网关时，这些网关可能会因为系统负载或其他因素而**同步**，导致它们几乎同时发送更新消息。

**解决方案**：

- 使用一个不受**系统负载或前一个更新定时器服务时间**影响的时钟来触发30秒更新。
- 每次设置30秒定时器时，都添加一个小的随机时间偏移量，以避免同步。



#### 2. 超时定时器和垃圾回收定时器

每条路由都有2个定时器：**超时定时器和垃圾回收定时器**。

超时后，该路由将不再有效。但是，它会在表中**保留很短的一段时间**，以便通知邻居该路由已经被丢弃。

当路由删除定时器到时间时，路由最终会从表中删除。

> 超时定时器初始化时机：建立路由或收到路由的更新时。如果距离上次初始化超时时间**超过180秒**，则认为该路由已经过期，随后会启动删除路由操作。

> 垃圾回收定时器：当路由因为**超时**或**收到特定更新（如度量值被设置为16，表示不可达）**而开始删除流程时，会为这个路由设置一个120秒的垃圾收集定时器。在这个定时器过期后，路由最终从路由表中删除。并设置一个标志，表示该条目已被更改，并向输出进程发出信号以触发响应。



### 输入处理

#### 1. 格式检查

在UDP端口520上接收到的数据报的处理过程。

1. 进行数据报文的格式检查
   - 版本号
     - =0，则忽略该数据包
     - =1，将按照本规范其余部分的描述进行处理
     - \>1，数据报将按照本规范其余部分的描述进行处理

#### 2. Request请求

​	用于请求主机全部或部分的路由表。从UDP源端口520以广播形式发送。

> ”静“进程如果收到来自520端口的请求，则不用响应；若是其他的UDP端口，就必须要响应



- **特殊请求：**如果请求中只有一个条目，地址族标记为0（表示未指定），度量值为无穷大（16），则是<font color='red'>获取整个路由表的请求</font>。

- 普通请求：处理请求是逐项处理的，如果没有条目，不会作出响应。对于请求中的条目列表的每个条目，会在主机的路由数据库中查找目的路由。

  - 如果有路由，则将该路由的度量值放到数据报文的度量字段中

  - 如果没有到指定目的地的路由，则将无穷大值16放到数据报文的度量字段中

​	一旦条目被填满（25条），设置命令响应并将数据报文发送回它来自的端口。

> 如果请求是针对完整的主机路由表，则完成正常的输出处理。这包括**水平分割和子网隐藏**，这样路由表中的某些条目就不会显示出来。
>
> 如果请求是针对特定的表项，则在主机表中查找它们并返回信息。在这种情况下，不会进行分割范围处理，且如果请求中明确需要，子网信息也会被返回。

> 当一个主机刚刚启动时，它会向所有连接的网络广播请求，以获取完整的路由表。
>
> 完整路由表的请求通常用于更新其他主机的路由表，因此需要进行水平分割和其他形式的过滤，以确保路由信息的准确性和避免路由循环。
>
> 而对特定网络的请求则主要用于诊断目的，不参与实际的路由决策过程。



#### 3. Response响应

收到以下三种情况请求的响应处理：

- 获取整个路由表的请求
- 定期更新路由的请求
- 通过度量值得改变触发的更新请求



收到请求后的响应，第一步需要检查响应的有效性。

- 响应验证
  - 检查响应是否来自520端口，若不是，则忽略它
  - 检查数据报文的源IP地址，是否来自一个邻居主机 `数据包必须是处于一个直连网络的设备发送的。`
  - 检查响应是否来自主机自身的地址，以避免处理自己的输出作为新输入。

- 响应内容处理
  - 逐一处理响应中的条目，首先进行验证。如果度量值大于无穷大（16），则忽略该条目。
  - 检查目的地址
    - 查看地址族标识符是否是internet（2），如果不是2，则忽略该条目。
    - 地址类型（如果为D类、E类地址、或在网络0上（0.0.0.0默认路由除外）或在网络127上（回环网络）、广播地址以及地址中未使用的八位字节中出现非0（如果协议版本为1），则忽略该条目。
  - 更新度量值
    - 通过添加消息到达的网络开销来更新度量，如果结果大于16，则使用16作为新的度量值。

![image-20240925140142639](./RIP.assets/image-20240925140142639.png)

- 路由表更新

  - **添加新路由**：如果路由表中没有该目的地址的路由，并且满足添加条件（如度量值不是无穷大，且主机不是已存在主网络或子网的一部分），则添加新路由。

    > - 将新路由的目的地址和度量值设置为数据包中目的地址和度量值
    > - 将网关设置为数据包来源的主机
    > - 初始化路由超时。如果有垃圾回收定时器，则停止它
    > - 设置路由更改标志，并向输出进程发出信号触发更新

  - **更新现有路由**：如果路由表中已存在该目的地址的路由，则根据**网关**和**度量值**进行比较和更新。若网关相同，则初始化超时定时器；再比较度量值， 如果新度量值更低或度量值不同，则执行

    > - 使用数据报文中的路由。即设置为数据报文中的度量值，并将网关设置为源主机
    > - 初始化超时定时器
    > - 设置路由更改标志，并向输出进程发出信号触发更新
    > - 如果新的度量值为16（无穷大），则开始删除进程

  - **删除路由**：如果新度量值为无穷大（16），则开启删除路由过程。该路由将不再用于路由数据包，并启动垃圾回收定时器。

    > 注意：只有**当度量值第一次被设置为16时，删除才会开始**。如果度量值已经为16，则不会开始新的删除。(开始删除会设置一个计时器。值得关注的是，我们不希望每30秒重置一次计时器，因为新消息到达时带有无限度量。)

  

### 输出处理

用于创建包含全部或部分路由表的响应消息的处理。

触发方式（3种）

- 请求响应：当接收到请求时，生成响应，且仅发送给一个目的地
- 定期更新：每30秒发送包含整个路由表的响应给所有相邻网关。
- 触发更新：当路由的度量值发生变化时，就会触发更新



通常，当要向**所有目的地**发送响应时(即定期更新或触发更新)，将响应发送到每个连接的点对点链路的另一端的主机，并在所有支持广播的连接网络上广播响应。因此，**为每个直连网络准备一个响应，并发送到相应的(目的地或广播)地址**。

在大多数情况下，这将到达所有相邻的网关。然而，在某些情况下，这可能还不够好。**这可能涉及不支持广播的网络**(例如，ARPANET)，或者涉及**哑网关**的情况。在这种情况下，可能需要指定相邻主机和网关的实际列表，并显式地向每个主机和网关发送数据报。这是留给实现者来决定是否需要这样的机制，并定义如何指定列表。

触发的更新需要特殊处理有两个原因。首先，经验表明，**触发更新**可能会**在容量有限或网关众多的网络上**造成过大的负载。因此，协议要求实现者包括限制触发更新频率的条款。**在触发更新发送后，应该设置一个计时器，在1到5秒之间随机设置一个时间**。如果在计时器到期之前发生其他会触发更新的变化，则在计时器到期时触发单个更新，然后将计时器设置为1到5秒之间的另一个随机值。如果在被触发的更新发送时间之前有一个常规更新到期，则触发的更新可能会被抑制。

其次，触发更新不需要包括整个路由表，只需要包括那些已经发生变化的路由。因此，作为触发更新的一部分生成的消息必须至少包括那些设置了路由更改标志的路由。它们可以包括额外的路由，或者所有的路由，由实现者自行决定;但是，当完全路由更新需要多个数据包时，强烈不建议发送所有路由。当处理触发的更新时，应该为每个直连网络生成消息。分割水平处理在生成触发更新和正常更新时完成。



#### 为特定直连网络生成响应数据报

- 源IP地址：发送数据包的主机IP地址

  > 有时网关在单个物理接口上设置多个IP地址。这意味着多个逻辑IP网络在一个物理介质上传输。在这种情况下，必须为每个地址发送单独的更新消息，并将该地址作为IP源地址。

- 版本号：设置为RIP的版本（1或2）

- 命令：设置为2（响应），并将必须为零的字节设为零

- 条目：遍历内部路由表，填充响应条目。每个数据报的最大大小为512字节，若空间不足，则发送当前消息并开始新的消息。

  > 如果正在生成触发更新，则只需要包含设置了路由更改标志的条目。

- 

  

## RIP程序执行过程

- 初始化

  启动一个路由守护程序，判断开启了哪些接口，并在每个接口上发送一个**特殊请求报文**（command字段为1，地址族标识字段为0，度量字段设置为16），要求与其某个直连路由器发送完整的路由表。

  > 在点对点链路中，请求是发送给其他终点的。
  >
  > 如果支持广播的话，请求是以广播形式发送的。

- 接收到请求
  - 若收到的是特殊请求报文，路由器需要**以单播形式发送**其完整的路由表给请求者。
  - 若是路由更新的请求报文，则处理请求中的每一个表项；如果有连接到指明地址的路由，则将度量设置成我们的值，否则设置为16，然后发送响应。
- 接收到响应
  - 可能会更新路由表
  - 可能会增加新表项，对已有表项进行修改或是删除
- 定期选路更新
  - 每过30s，所有或部分路由器会将其完整的路由表发送给相邻路由器（以广播形式或点对点链路的其他终点的）
- 触发更新
  - 当每条路由的度量发生变化时，就对他更新。不需要发送完整的路由表，而只需要发送那些发生变化的表项。

每条路由都有与之关联的定时器。如果运行RIP的系统发现一条路由在3分钟内未更新，就将该路由的度量设置为16（无穷大），并标记为删除。

> 意味着在6个30s更新时间里没收到`通告该路由的路由器`的更新了。再过60s，从本地路由表中删除该路由，以保证该路由的失效已被传播开。



## 开启RIP协议的路由查询过程

当一个数据包到达开启RIP的路由器后，路由器将进行路由表的查询，定位数据包的下一跳。

1. 首先，读出数据包目的地址的网络部分（基于有类别路由选择协议的主网络号）
   - **根据有类别路由表查询规则**，读出基于A类、B类或C类主网分类的网络号。
2. 查看这个网络部分在路由表中是否有其匹配的条目。
   - 如果没有匹配条目，则丢弃该数据包 ，同时发送一个ICMP目的不可达的消息给发送数据包的源端。
   - 如果有，那么路由表中会列出匹配这个主网络的所有子网，并进一步再这些子网中进行筛查。
     - 若有子网与其匹配，则转发该数据包
     - 若没有，则被丢弃，并发送一个ICMP目的不可达的消息。

### 案例

（1）假设有一个目的地址为 192.168.35.3 的数据包进入路由器，由于该路由器在路由表中没有发现和网络 192.168.35.0 （C类）匹配的条目，因此该数据包将被丢弃。

（2）假设有一个目的地址为 172.25.33.89 数据包进入路由器，在路由表中有一个和 B 类网络 172.25.0.0/24 匹配的条目，那么进一步检查路由表中列出的网络 172.25.0.0/24 的子网条目；显然没有和网络 172.25.33.0 匹配的子网条目，因此该数据包被丢弃。

（3）最后一个例子，假设要到达地址 172.25.153.220 的数据包进入路由器，这时，路由表中有和网络 172.25.0.0/24 匹配的条目，进一步检查到有和子网 172.25.153.0 匹配的条目，因此，该数据包将被转发到下一跳地址 172.25.15.2。







## RIP配置

### 常用命令

| 命令                                                         | 说明                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| **debug ip rip [events]**                                    | 简要地**显示路由器收发的RIP信息**                            |
| **ip address** ip-address mask **secondary**                 | 在接口上指定一个ip地址作为辅助地址                           |
| **ip rip triggered**                                         | 在某个接口上配置RIP的触发扩展特性                            |
| **neighbor** ip-address                                      | 通过指定接口邻居的IP地址来建立邻接关系                       |
| <font color='red'>**network** network-number</font>          | 指定一个需要运行RIP的网络                                    |
| **offset-list** {*access-list-number\|name*} {**in\|out**} *offset* [*type* *number*] | 指定路由表中一个与指定的访问列表匹配的路由条目，将自己的度量值增加一个指定的偏移量 |
| **output-delay** *delay*                                     | 设定一个指定延迟长度的延迟间隙，以便协调高速路由器和低速路由器之间的延迟问题 |
| <font color='red'>**router rip** </font>                     | 启动 RIP 进程                                                |
| **timers basic** *update invalid holddown flush*             | 修改指定的计时器的值                                         |
| **passive-interface** *type number*                          | 在指定类型和序列号的接口上阻止 RIP 广播                      |



### 配置RIP协议

1.  开启RIP进程

   ```bash
   router rip
   ```

2.  进入到 **config-router** 配置模式，指定每个需要运行RIP协议的**主网络**

   ```bash
   network network-number
   ```

   由于 RIP 协议具有**有类别路由选择**的特性，从而**在网络边界上会出现子网屏蔽**的情形，这意味着 **network 命令中不需要指定子网**，而**仅仅需要指定相对应的 A 类、B 类或 C 类的主网络地址**。任何一个接口，只要它的配置地址属于 **network** 命令指定的网络，都将会运行 RIP。

### 案例

#### 1. 基本RIP配置案例

一个含有 4 台路由器的网络，它包含 4 个主网络号（10.0.0.0、192.168.83.0、192.168.12.0、172.17.0.0）。路由器 Goober 和网络172.17.0.0 的两个子网相连。

<img src="./RIP.assets/image-20240924173950825.png" alt="image-20240924173950825" style="zoom: 67%;" />

**1. 对路由器进行RIP配置**

- **路由器Goober的RIP配置**

B类地址

```bash
router rip
  # version 2 -- RIP版本
  network 172.17.0.0  # 通告网段，是主类网段（B类）。如果通告的不是主类网段，会被设备修改为主类网段
```

- **路由器Opie的RIP配置**

B类地址

```
router rip
  network 172.17.0.0
```

- **路由器Barney的RIP配置**

A、C类地址

```c
router rip
  network 10.0.0.0
  network 192.168.83.0
```

- **路由器Andy的RIP配置**

A、C类地址

```
router rip
  network 10.0.0.0
  network 192.168.12.0
  network 192.168.83.0
```

```
show ip route rip
```

**2. 在路由器Andy上开启RIP协议的调试命令**

```cmd
Andy#debug ip rip
```

> 192.168.12.010 00001 (27)
>
> 192.168.12.110 00011 (27)

- 由于 E0（192.168.12.65/27）和E2接口（192.168.12.195/27）都是和192.168.12.0**相连的**，所以子网192.168.12.64 和192.168.12.192可以在这两个接口上进行通告。
- 在和其他**不同的网络相连**的E1（192.168.83.1/24）、S0（172.17.1.1/24）、S1（172.17.2.1/24）接口上，这两个子网需要**汇总后**才通告出去。
- 同样地，192.168.83.0和172.17.0.0在通过**有类别网络边界**时，也会被路由汇总后通告出去。

<img src="./RIP.assets/image-20240925090352333.png" alt="image-20240925090352333" style="zoom: 67%;" />

<img src="./RIP.assets/屏幕截图 2024-09-24 175847.png" alt="屏幕截图 2024-09-24 175847" style="zoom: 67%;" />

#### 2. 被动接口案例

在网络中增加路由器 Floyd，但不希望在路由器 Floyd 和 Andy 之间交换 RIP协议的通告消息。

<img src="./RIP.assets/image-20240925093415546.png" alt="image-20240925093415546" style="zoom: 50%;" />

- **路由器Floyd配置**

```bash
router rip
	network 192.168.100.0
```

没有设置包含192.168.12.0的network命令，路由器Floyd就不会在E0接口上通告192.168.12.0。但是，路由器 Andy 有两个和网络 192.168.12.0 相连的接口，因此网络 192.168.12.0 必须包含在 RIP 中。如

如果一台路由器接口**处于一个启动 RIP协议的网络的子网**中，那么路由器**会在该接口上发出 RIP 广播**，为了阻塞这样的 RIP 广播，在 RIP 的处理中就需要增加一条 **passive-interface** 命令。

- **路由器Andy的被动接口配置**

```
router rip
	passive-interface Ethernet0
	network 172.17.0.0
	network 192.168.12.0
	network 192.168.83.0
```

> 命令 **Passive-interface** 不是 RIP 协议专有的命令，它可以在所有的 IP 路由选择协议中配置使用。
>
> 通过该命令，使得在一条特定的数据链路上，将路由器作为一台“静”主机来看待，即只在特定链路上监听RIP广播，从而更新自己的路由表。与”静“主机不同的是，在被动接口上，不会响应请求的消息。



#### 3. 配置单播更新案例

​	增加一台新的路由器 Bea，并连接到路由器 Andy 和 Floyd 之间的以太网共享链路上。在路由器 Andy 和 Floyd 之间的链路上依然保留不启动 RIP协议的路由策略，但在路由器 Bea 和 Andy 之间，Bea 和 Floyd 之间现在都必须交换 RIP通告消息。

<img src="./RIP.assets/image-20240925094831018.png" alt="image-20240925094831018" style="zoom: 50%;" />

- **路由器Bea的RIP配置**

```
router rip
	network 192.168.12.0
	network 192.168.200.0
```

- **路由器Andy的RIP配置**

通过neighbor命令，使得RIP协议能以单播方式向路由器Bea的接口发送通告，而此时，路由器Andy上的passive-interface命令仍继续防止在该链路上广播更新。

```
router rip
	passive-interface Ethernet0
	network 172.17.0.0
	network 192.168.12.0
	network 192.168.83.0
	neighbot 192.168.12.67
```

**路由器Floyd的RIP配置**

因为路由器 Floyd 现在必须发送 RIP 通告给路由器 Bea，因此也必须增加一条通告192.168.12.0 的 **network** 命令。为了防止广播更新，也要增加一条 **Passive-interface** 命令，并且要增加 **neighbor** 命令以单播方式通告 RIP 更新给路由器 Bea。

```
router rip
	passive-interface Ethernet0
	network 192.168.100.0
	network 192.168.12.0
	neighbor 192.168.12.67
```



#### 4. 不连续的子网案例

​	另一台路由器Ernest_T被添加到原来的网络上，它通过一个 E1 接口和子网 10.33.32.0/20相连。现在问题出现了，网络 10.0.0.0 的另一个子网（10.33.0.0/20）是和路由器 Barney 相连的，它和子网 10.33.32.0/20 之间只有一条惟一的经过网络 192.168.83.0 和 192.168.12.0 的路由路径，而这是它们完全不同的两个网络。结果，网络 10.0.0.0 将变成为不连续的。

<img src="./RIP.assets/image-20240925100131919.png" alt="image-20240925100131919" style="zoom: 50%;" />

路由器 Barney 会认为自己是网络 10.0.0.0 和网络 192.168.83.0 之间的边界路由器；

路由器 Ernest_T 也会认为自己是网络 10.0.0.0 和网络 192.168.12.0 之间的边界路由器。

它们都将通告一条网络 10.0.0.0 的汇总路由，结果路由器 **Andy** 将会“傻乎乎”地认为它有**两条等价的路径**可以到达同一个网络。在这种情况下，路由器 Andy 将在与路由器 Barney 和Ernest_T 相连的链路上进行**均分负载**，因而，要到达网络 10.0.0.0 的数据包现在只有 50%的机会可以转发到正确的子网上。

<img src="./RIP.assets/image-20240925101800805.png" alt="image-20240925101800805" style="zoom: 50%;" />

> 解决方法是在网络 192.168.83.0/24 和 192.168.12.192/27 **<font color='red'>所在的同一条链路上配置网络10.0.0.0 的子网</font>**，这可以通过在路由器接口上配置辅助 IP 地址（secondary IP address）实现。

- **路由器Barney配置辅助IP地址**

```
interface e0
	ip address 10.33.55.1 255.255.240.0 secondary
```

- **路由器Andy配置辅助IP地址，并在RIP中新增一个网络**

因为路由器 Andy 在前面的配置中没有和网络 10.0.0.0 相连的接口，所以在 RIP 配置中增加了一条网络声明（**network** 10.0.0.0）

```
interface e1
	ip address 10.33.55.2 255.255.240.0 secondary
interface e2
	ip address 10.33.75.1 255.255.240.0 secondary
router rip
	network 10.0.0.0
```

- **路由器Ernest_T配置辅助IP地址**

```
interface e0
	ip address 10.33.75.2 255.255.240.0 secondary
```

<img src="./RIP.assets/image-20240925102215638.png" alt="image-20240925102215638" style="zoom: 50%;" />